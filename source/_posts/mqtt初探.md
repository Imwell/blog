---
title: mqtt初探
date: 2021-01-30 15:29:59
tags:
    - mqtt
categories:    
   - protocol
cover: false
---
# 什么是MQTT
MQTT（Message Queuing Telemetry Transport，消息队列遥测传输协议），是一种基于发布/订阅（publish/subscribe）模式的“轻量级”通讯协议，该协议构建于TCP/IP协议上，由IBM在1999年发布。MQTT最大优点在于，可以以极少的代码和有限的带宽，为连接远程设备提供实时可靠的消息服务。做为一种低开销、低带宽占用的即时通讯协议，使其在物联网、小型设备、移动应用等方面有较广泛的应用。 
# 协议的特点
- 基于TCP协议的应用层协议
- 采用C/S架构
- 使用订阅/发布模式，将消息的发送方和接受方解耦
- 提供3种消息的QoS（Quality of Service）：至多一次、最少一次、只有一次
- 收发消息都是异步的，发送方不需要等待接收方应答

MQTT协议可以为大量的低功率、工作网络不可靠的物联网设备提供通讯保障。
MQTT是在低带宽高延迟不可靠的网络下进行数据相对可靠传输的应用层协议。
                                    
# 协议原理
## 协议的实现方式
它主要由三种身份：发布者、订阅者、代理。其中，消息的发布者和订阅者都是客户端，代理是服务端
![MQTT构成](/img/mqtt.png)
mqtt传输的消息可以分为两部分：
- 荷载(Payload)：消息的内容，订阅者接收到的内容
- 主题(Topic)：消息的类型，订阅者订阅（Subscribe）后，就会收到该主题的消息内容（payload）
## 网络传输和应用消息
MQTT会构建底层网络传输：它将建立客户端到服务器的连接，提供两者之间的一个有序的、无损的、基于字节流的双向传输。
当应用数据通过MQTT网络发送时，MQTT会把与之相关的服务质量（QoS）和主题名（Topic）相关连。
## mqtt客户端
一个使用MQTT协议的应用程序或者设备，它总是建立到服务器的网络连接。客户端可以：
- 发布其他客户端可能会订阅的信息
- 订阅其它客户端发布的消息
- 退订或删除应用程序的消息
- 断开与服务器连接
## mqtt服务端
MQTT服务器以称为“消息代理”（Broker），可以是一个应用程序或一台设备。它是位于消息发布者和订阅者之间，它可以：
- 接受来自客户的网络连接
- 接受客户发布的应用信息
- 处理来自客户端的订阅和退订请求
- 向订阅的客户转发应用程序消息
## MQTT协议中的订阅、主题、会话
### 订阅（Subscription）
订阅包含主题筛选器（Topic Filter）和最大服务质量（QoS）。订阅会与一个会话（Session）关联。一个会话可以包含多个订阅。每一个会话中的每个订阅都有一个不同的主题筛选器。
### 会话（Session）
每个客户端与服务器建立连接后就是一个会话，客户端和服务器之间有状态交互。会话存在于一个网络之间，也可能在客户端和服务器之间跨越多个连续的网络连接。
### 主题名（Topic Name）
连接到一个应用程序消息的标签，该标签与服务器的订阅相匹配。服务器会将消息发送给订阅所匹配标签的每个客户端。
### 主题筛选器（Topic Filter）
一个对主题名通配符筛选器，在订阅表达式中使用，表示订阅所匹配到的多个主题。
### 负载（Payload）
消息订阅者所具体接收的内容
## MQTT协议中的方法
MQTT协议中定义了一些方法（也被称为动作）， 来于表示对确定资源所进行操作。 这个资源可以代表预先存在的数据或动态生成数据，这取决于服务器的实现。通常来说，资源指服务器上的文件或输出。
- Connect，等待与服务器建立连接
- Disconnect，等待MQTT客户端完成所做的工作，并与服务器断开TCP/IP会话
- Subscribe，等待完成订阅
- UnSubscribe，等待服务器取消客户端的一个或多个topics订阅
- Publish，MQTT客户端发送消息请求，发送完成后返回应用程序线程
## 常见的MQTT服务端
- artemis：它支持多种的服务端，比如rabbitmq等 

 参考：https://www.cnblogs.com/jiangzhaowei/p/7794640.html
